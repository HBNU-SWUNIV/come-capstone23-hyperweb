<!DOCTYPE html>
<html>
<head>
    <title>Nutrient Analysis</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <style>
        .overlay {
            position: absolute; 
            top: 0; 
            bottom: 0; 
            left: 0; 
            right: 0;
            text-align: center;
            height: 50vh; /* overlay의 높이도 같게 조절 */
            border-bottom: 2px solid rgba(128, 128, 128, 0.7);
        }

        .profile-image {
            border-radius: 50%;
            width: 150px;
            height: 150px;
            object-fit: cover;
            position: absolute;
            top: 20%; /* top 값을 50%로 변경 */
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .overlay-text {
            position: absolute;
            top: 60%; /* top 값을 50%로 변경 */
            left: 50%;
            transform: translate(-50%, -50%);
            color: black;
            font-size: 2em;
        }

        .nutrition-image {
            width: 100%;
            height: 50vh;
            object-fit: cover;
        }

        .container {
            margin-top: 50px; /* 공간 추가 */
        }

        .like-button {
            color: #000000;
        }

        .like-button.clicked {
            color: #ff0000;
        }
        .button-container {
            position: absolute;
            top: 65%; /* 버튼을 아래에 위치시키기 위해 top 값 조정 */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
        }

        .button-container button {
            margin-right: 10px;
            background-color: #FEFAE0;
            border: none;
            border-radius: 50%;
        }

        .button-container i {
            font-size: 48px;
            color: #000000;
        }
    </style>
    <script>
        function printFunction() {
            // 프린트 버튼 동작 정의
            console.log("프린트 버튼이 클릭되었습니다.");
            window.print();
        }

        function downloadFunction() {
            console.log("프린트 버튼이 클릭되었습니다.");
            window.print();
        }

        function likeFunction() {
            // 좋아요 버튼 동작 정의
            console.log("좋아요 버튼이 클릭되었습니다.");
            var likeButton = document.querySelector('.like-button');
            likeButton.classList.toggle('clicked');
        }
        function captureFunction() {
            html2canvas(document.body).then(function(canvas) {
                var dataURL = canvas.toDataURL();
                $.ajax({
                    type: "POST",
                    url: '{% url "report_post" %}',
                    data: {
                        images: dataURL
                    },
                    success: function() {
                        location.replace('/main');
                    }
                });
            });
        }
        
    </script>
</head>
<body>
    <!-- nutrition-image 클래스 추가 -->
    <img class="nutrition-image" src="/media/recipe_image2.jpg" alt="Nutrition image">
    <img src="/media/default_profile.png" alt="Profile image" class="profile-image">    
    <div class="container">
        
        <div class="overlay">
            <div class="overlay-text">"댕댕이1"을 위한 식단 보고서</div>
            <div class="button-container">
                <button class="btn btn-primary mr-2" onclick="printFunction()">
                    <i class="material-icons">print</i>
                </button>
                <button class="btn btn-primary mr-2" onclick="downloadFunction()">
                    <i class="material-icons">download</i>
                </button>
                <button class="btn btn-primary" onclick="likeFunction()">
                    <i class="material-icons like-button">favorite</i>
                </button>
                <button class="btn btn-primary" onclick="captureFunction()">
                    <i class="material-icons like-button">share</i>
                </button>

            </div>
        </div>
    </div>
    <div class="container">
        <h2>음식 유형: 단백질이 풍부한 식단</h2>           
        </table>
        <div class="container mt-4">
            <div class="row no-gutters">
                <div class="col-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title font-weight-bold">총 칼로리</h5>
                            <p class="card-text display-4">1000</p>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title font-weight-bold">단백질</h5>
                            <p class="card-text display-4">{{ 30 }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title font-weight-bold">지방</h5>
                            <p class="card-text display-4">{{ 20 }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title font-weight-bold">탄수화물</h5>
                            <p class="card-text display-4">{{ 50 }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row no-gutters"> <!-- mt-4를 삭제하여 박스들이 세로로 붙어있게 만듭니다 -->
                <div class="col-1"></div> <!-- 이 부분을 추가하여 박스들을 중앙으로 이동 -->
                <div class="col-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title font-weight-bold">수분량</h5>
                            <p class="card-text display-4">{{ 100 }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title font-weight-bold">충족한 영양소 갯수</h5>
                            <p class="card-text display-4">{{ 100 }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-3 mb-4"> <!-- mb-4를 추가하여 박스와 그 아래의 표 사이에 마진을 추가 -->
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title font-weight-bold">부족한 영양소 갯수</h5>
                            <p class="card-text display-4">{{ 100 }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-1"></div> <!-- 이 부분을 추가하여 박스들을 중앙으로 이동 -->
        
         <table class="table">
            <thead class="thead-dark">
                <tr>
                    <th>식재료명</th>
                    <th>무게</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>식재료1</td>
                    <td>100g</td>
                </tr>
                <tr>
                    <td>식재료2</td>
                    <td>50g</td>
                </tr>
                <tr>
                    <td>식재료3</td>
                    <td>75g</td>
                </tr>
            </tbody>       
        <table class="table">
            <thead class="thead-dark">
                <tr>
                    <th>Nutrient</th>
                    <th>Actual Value</th>
                    <th>Percentage</th>
                    <th>Minimum Value</th>
                </tr>
            </thead>
            <tbody>
                {% for nutrient in nutrients %}
                <tr>
                    <td>{{ nutrient.name }}</td>
                    <td>{{ nutrient.actual_value }}</td>
                    <td style="max-width: 100%;">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: {% if nutrient.actual_value > nutrient.minimum_value %}100{% else %}{% widthratio nutrient.actual_value nutrient.minimum_value 100 %}{% endif %}%;" aria-valuenow="{{ nutrient.actual_value }}" aria-valuemin="0" aria-valuemax="{{ nutrient.minimum_value }}"></div>
                        </div>
                    </td>
                    <td>{{ nutrient.minimum_value }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>
